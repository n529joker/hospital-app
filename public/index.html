<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>load data</title>
</head>
<body>
    <button onclick="getData()">check</button>
    <script>
   document.addEventListener('DOMContentLoaded',getData)
   async function getData(){
     try{
           let data = await fetch('https://ipgeolocation.abstractapi.com/v1/?api_key=ae155d7394704c93be9c72486e2bd7f5')
           let fdata = await data.json()
           let reg = localStorage.getItem('region')
       if(reg == null || reg == undefined || reg !== fdata.region){
            localStorage.setItem('region',`${fdata.region}`)
            alert('New Region added!')
       }else{
            let RE = localStorage.getItem('region')
        let reg = {
            region:RE
        }
         await getLocalData(reg)
       }
    }
    catch(ex){
        console.log('Request failed ', ex);
        }
      }
 async function getLocalData(region){
   let data = {
       method: 'POST',
       header:{
          'Content-Type':'application/json'
        },
       body: JSON.stringify(region)
      }
    try{       
        let sdata = await fetch('https://hospitalcmr.herokuapp.com/data', data)
        let resdata = await sdata.json()
        console.log(resdata)
        }
        catch(ex){
            console.log(ex)
        }
   }
</script>
</body>
</html>
